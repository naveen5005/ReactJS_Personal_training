<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="main">
        <div id="left">
            <ul>

            </ul>
        </div>
        <div id="right">
            <h1 style="text-align: center;">Interview questions</h1>
            <form action="">

            </form>
        </div>
    </div>
    <script>

        let questions = [];

        handleDragEelements = () => {
            const items = document.querySelectorAll(".item");
            const droppableArea = document.querySelector("#right");

            // Enable draggable functionality for each item
            items.forEach(function (item) {
                item.addEventListener("dragstart", function (e) {
                    e.dataTransfer.setData("text/plain", e.target.innerText);
                });
            });
            droppableArea.addEventListener("dragover", function (e) {
                e.preventDefault();
            });
            droppableArea.addEventListener("drop", function (e) {
                // e.preventDefault();
                const data = e.dataTransfer.getData("text/plain");
                const newItem = document.createElement("div");
                var h4 = document.createElement("h4");
                h4.innerHTML = "Question from Input type " + data + ": <br>";
                h4.setAttribute("style","text-decoration:underline");
                newItem.appendChild(h4);
                // newItem.innerHTML = "Question from Input type " + data + ": <br>";
                newItem.setAttribute("class", "form main container");
                questions.forEach((question) => {
                    var inputType = data.charAt(0).toLowerCase() + data.slice(1);
                    if (question.type === inputType) {
                        for (a in question) {
                            delete question.id;
                            var myDiv = document.createElement("div");
                            if (a !== "type" && a !== "options") {
                                var mylabel = document.createElement("label");
                                mylabel.innerHTML = question[a] + ": <br>";
                                var myInput = document.createElement("input");
                                myInput.setAttribute("type", question[a]);
                                myInput.setAttribute("class", "form-control custom-input");
                                myDiv.appendChild(mylabel);
                                myDiv.appendChild(myInput);
                                newItem.appendChild(myDiv);
                            } 
                            else{
                                if ((a == "options") && (inputType === "checkbox" || inputType === "radio")) {
                                    question[a].forEach((data) => {
                                        var myDivCheck = document.createElement("div");
                                        for (b in data) {
                                            if (b === "label") {
                                                var InnerInput = document.createElement("input");
                                                InnerInput.setAttribute("type", inputType);
                                                InnerInput.setAttribute("class", "form-check-input");
                                                InnerInput.setAttribute("style", "margin-right:5px");
                                                inputType === "radio" ? InnerInput.setAttribute("name", "status") : InnerInput.setAttribute("name", data[b]);
                                                myDivCheck.appendChild(InnerInput);
                                            } else if (b === "value") {
                                                var innerLabel = document.createElement("label");
                                                innerLabel.innerHTML = data[b];
                                                innerLabel.setAttribute("class", "form-check-label custom-label");
                                                myDivCheck.appendChild(innerLabel);
                                            }
                                        }
                                        myDivCheck.setAttribute("class", "form-check");
                                        myDiv.appendChild(myDivCheck);
                                        newItem.appendChild(myDiv);
                                    })
                                }
                                else if (a == "options" && inputType === "select") {
                                    var select = document.createElement("select");
                                    select.setAttribute("class", "dropdown");
                                    question[a].forEach((data) => {
                                        var option = document.createElement("option");
                                        var optDiv = document.createElement("div");
                                        for (c in data) {
                                            if (c === "label") {
                                                option.innerHTML = data[c];
                                                option.value = data[c];
                                            }
                                            option.setAttribute("class", "dropdown-item");
                                            select.appendChild(option);
                                        }
                                    })
                                    myDiv.appendChild(select);
                                    newItem.appendChild(myDiv);
                                }
                            }
                            myDiv.setAttribute("style", "margin-bottom :20px")
                        }
                    }
                })
                document.querySelector("form").appendChild(newItem);
                droppableArea.appendChild(document.querySelector("form"));
            });
        }
        displayQuestions = () => {
            try {
                if (questions.length > 0) {
                    questions.forEach((data) => {
                        var li = document.createElement("li");
                        li.innerHTML = data.type;
                        li.setAttribute("class", "item");
                        li.setAttribute("draggable", true);
                        document.querySelector("ul").appendChild(li);
                    })
                }
            } catch (error) {
                console.log("Error is : " + error);
            }
            handleDragEelements()
        }
        getDataFromAPI = async () => {
            var results = await (await fetch("http://localhost:3000/questions")).json();
            questions = results;
            console.log(questions)
            displayQuestions();
        }
        getDataFromAPI();
    </script>
</body>

</html>