<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FORM Builder-01</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>FORM BUILDER - 01</h1> <br>
    <select name="" id="allForms" onchange="handleChange()"></select> <br><br>
    <form action="">

    </form>
    <button type="button" style="display: none;" value="Contact Information" id="Contact Information" onclick="contactTableData()">Contact Data
        Display</button>
    <button type="button" style="display: none;" value="Survey" id="Survey" onclick="surveyTableData()">Survey Data Display</button>
    <button type="button" style="display: none;"value = "Registration" id="Registration" onclick="registrationTableData()">Registration Data
        Display</button>
    <button type="button" style="display: none;" value="Feedback" id="Feedback" onclick="feedbackTableData()">feedback Data
        Display</button>
    <button type="button" style="display: none;" value = "Order" id="Order" onclick="orderTableData()">order Data Display</button>

    <script>

        let allForms = [];
        let ObjectIterate = {}
        
        var Contact = document.getElementById("Contact Information");
        var survey = document.getElementById("Survey");
        var registration = document.getElementById("Registration");
        var feedback = document.getElementById("Feedback");
        var order = document.getElementById("Order");
        displayNone = () =>{
            Contact.setAttribute("style","display:none");
            survey.setAttribute("style","display:none");
            registration.setAttribute("style","display:none");
            feedback.setAttribute("style","display:none");
            order.setAttribute("style","display:none");
        }
        commonServerCommunicationFORMS = (method) => {
            method === "GET" ? url = "http://localhost:3000/forms" : url = "http://localhost:3000/forms";
            fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: null,
            }).then((response) => {
                if (!response.ok) {
                    throw new Error("Response is not ok...!!!");
                }
                return response.json();
            }).then((data) => {
                console.log(data)
                allForms = data;
                displayFormNames();
            })
        }
        commonServerCommunicationFORMS("GET");
        displayFormNames = () => {
            allForms.forEach((formObj) => {
                let option = document.createElement("option");
                option.innerHTML = formObj.formName;
                option.value = formObj.formName;
                option.setAttribute("name", formObj.formName)
                document.querySelector("select").appendChild(option);
            })
        }
        function clearKeysInObject(obj) {
            for (const key in obj) {
                delete obj[key];
            }
        }
        handleButtonEventActions = (value) => {
            var survey = document.getElementById(value);
            survey.setAttribute("style", "display:block");
        }
        handleChange = () => {
            document.querySelector("form").innerHTML = "";
            displayNone();
            let formDetails = allForms.find((form, i) => {
                let allOptions = document.getElementsByName(form.formName);
                allOptions.forEach((element) => {
                    if (element.selected) {
                        console.log(element)
                        generateFORM(form.fields , form.formName);
                        handleButtonEventActions(form.formName);
                        clearKeysInObject(ObjectIterate);
                        form.fields.forEach((data) => {
                            for (a in data) {
                                if (a === "type") {
                                    ObjectIterate[data[a]] = "";
                                }
                            }
                        })
                    }
                })
            });
            returnObj(ObjectIterate);
        }
        generateFORM = (fields , formName) => {
            let inputFieldDiv = document.createElement('div');
            inputFieldDiv.setAttribute("class", "inputFieldDiv");
            fields.forEach((data, i) => {
                var myDiv = document.createElement("div");
                myDiv.setAttribute("class", "formsDetails");
                myDiv.setAttribute("style", "display:grid;grid-template-columns:1fr");
                for (a in data) {
                    var label = document.createElement("label");
                    let inputField = document.createElement("input")
                    if (a === "label") {
                        var myDiv1 = document.createElement("div");
                        label.innerHTML = data[a] + " : " + "<br>";
                        myDiv1.setAttribute("class", "second");
                        myDiv1.setAttribute("style", "grid-row:1");
                        myDiv1.appendChild(label);
                        myDiv.appendChild(myDiv1);
                    }
                    else if (a === "type") {
                        var myDiv2 = document.createElement("div");
                        inputField.setAttribute('id', data[a])
                        inputField.setAttribute(a, data[a]);
                        myDiv2.setAttribute("class", "first");
                        myDiv2.setAttribute("style", "grid-row:2");
                        myDiv2.appendChild(inputField);
                        myDiv.appendChild(myDiv2);
                    }
                }
                inputFieldDiv.appendChild(myDiv);
                document.querySelector("form").appendChild(inputFieldDiv);
            })
            var myDiv3 = document.createElement("div");
            var myButton = document.createElement("button");
            myButton.setAttribute("type", "button");
            console.log(formName);
            myButton.setAttribute("onclick", "addDetails("+formName+")");
            myDiv3.appendChild(myButton).innerHTML = 'Submit';
            inputFieldDiv.appendChild(myDiv3);
        }
        commonServerCommunicationData = (method, data, formName) => {
            if (formName === "Contact Information") {
                url = "http://localhost:3000/formDetails1"
            }
            else if (formName === "Survey") {
                url = "http://localhost:3000/formDetails2"
            } else if (formName === "Registration") {
                url = "http://localhost:3000/formDetails3"
            } else if (formName === "Feedback") {
                url = "http://localhost:3000/formDetails4"
            } else if (formName === "Order") {
                url = "http://localhost:3000/formDetails5"
            }
            fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
        }
        addDetails = (buttonData) => {
            console.log(buttonData);
            let formName = buttonData.value;
            // console.log(formName);
            if (formName === "Contact Information") {
                var data = readOnlyDataFromFOM();
                console.log(data);
                commonServerCommunicationData("POST", data,formName);
            }
            else if (formName === "Survey") {
                var data = readOnlyDataFromFOM();
                commonServerCommunicationData("POST", data,formName);
            } else if (formName === "Registration") {
                var data = readOnlyDataFromFOM();
                commonServerCommunicationData("POST", data,formName);
            } else if (formName === "Feedback") {
                var data = readOnlyDataFromFOM();
                commonServerCommunicationData("POST", data,formName);
            } else if (formName === "Order") {
                var data = readOnlyDataFromFOM();
                console.log(data);
                commonServerCommunicationData("POST", data,formName);
            }
        }
        surveyTableData = () => {
            window.location.href = "surveryData.html";
        }
        contactTableData = () =>{
            window.location.href = "contactData.html";
        }
        registrationTableData = () => {
            window.location.href = "registrationData.html"
        }
        feedbackTableData = () => {
            window.location.href = "feedbackData.html"
        }
        orderTableData = () =>{
            window.location.href = "orderData.html";
        }
        function returnObj(ObjectIterate) {
            return ObjectIterate;
        }
        function readOnlyDataFromFOM() {
            var data = returnObj(ObjectIterate);
            for (a in data) {
                data[a] = document.getElementById(a).value;
            }
            return data;
        }
    </script>
</body>

</html>