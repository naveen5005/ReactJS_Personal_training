<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Data Display</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <style>
        table,
        th,
        td {
            border: 2px solid black;
            border-collapse: collapse;
            text-align: center;
        }
        td{
            padding: 10px;
        }
        th {
            padding: 8px;
            text-align: center;
        }
    </style>
</head>

<body>
    <h1 style="text-align: center;">FORM DATA DISPLAY</h1>
    <button id="mainPage" type="button" onclick="returnPrevPage()" style="margin-left: 1300px;" class ="btn btn-dark">Return</button>
    <table style="margin: auto;">
        <thead>

        </thead>
        <tbody>

        </tbody>
    </table>
</body>
<script>
    returnPrevPage = () => {
        window.location.href = "formBuilder01.html";
    }
    let details = null;
    commonServerCommunication = (method, data) => {
        let stringData = localStorage.getItem("formName");
        let formName = JSON.parse(stringData);
        if (formName.name === "Contact Information") {
            method === "GET" ? url = "http://localhost:3000/formDetails1" : url = "http://localhost:3000/formDetails1/" + data.id;
            document.querySelector("h1").innerHTML = formName.name + "Table Data Display";
        } else if (formName.name === "Survey") {
            method === "GET" ? url = "http://localhost:3000/formDetails2" : url = "http://localhost:3000/formDetails2/" + data.id;
            document.querySelector("h1").innerHTML = formName.name + "Table Data Display";
        } else if (formName.name === "Registration") {
            method === "GET" ? url = "http://localhost:3000/formDetails3" : url = "http://localhost:3000/formDetails3/" + data.id;
            document.querySelector("h1").innerHTML = formName.name + "Table Data Display";
        } else if (formName.name === "Feedback") {
            method === "GET" ? url = "http://localhost:3000/formDetails4" : url = "http://localhost:3000/formDetails4/" + data.id;
            document.querySelector("h1").innerHTML = formName.name + "Table Data Display";
        } else if (formName.name === "Order") {
            method === "GET" ? url = "http://localhost:3000/formDetails5" : url = "http://localhost:3000/formDetails5/" + data.id;
            document.querySelector("h1").innerHTML = formName.name + "Table Data Display";
        }
        fetch(url, {
            method: method,
            headers: { 'Content-Type': 'application/json' },
            body: method === "PUT" ? JSON.stringify(data) : null,
        }).then((response) => {
            if (!response.ok) {
                throw new Error("Response is not ok...!!!");
            }
            return response.json();
        }).then((apiData) => {
            details = apiData;
            displayTable();
            headingDisplay();
        })
    }
    commonServerCommunication("GET");

    dynamicThText = (text, target) => {
        var Th = document.createElement("th");
        Th.innerHTML = text,
            target.appendChild(Th);
    }
    dynamicButtons = (text, target, event, data, btnStyle) => {
        var Td = document.createElement("td");
        var Button = document.createElement("button");
        Button.innerHTML = text;
        Button.setAttribute("class",btnStyle);
        Button.addEventListener("click", function () {
            event(data);
        })
        Td.appendChild(Button);
        target.appendChild(Td);
    }
    commonDataDisplayTable = (obj, cell, target, data) => {
        var myTr = document.createElement("tr");
        for (a in obj) {
            if (a !== "isEdit") {
                var myTh = document.createElement(cell);
                if (obj.isEdit) {
                    var myInput = document.createElement("input");
                    if (a == "id") {
                        myInput.setAttribute("id", a);
                        myInput.setAttribute("value", obj[a]);
                        myInput.setAttribute("readonly", "");
                        myInput.setAttribute("disabled", "");
                        myTh.appendChild(myInput);
                        myTr.appendChild(myTh);
                    } else {
                        myInput.setAttribute("id", a);
                        myInput.setAttribute("value", obj[a]);
                        myTh.appendChild(myInput);
                        myTr.appendChild(myTh);
                    }
                } else {
                    myTh.innerHTML = cell === "th" ? a : obj[a];
                    myTh.setAttribute("style", "padding:5px");
                    myTr.appendChild(myTh);
                }
            }
        }
        if (cell === "th") {
            dynamicThText("EDIT", myTr);
            dynamicThText("DELETE", myTr);
        } else {
            obj.isEdit ? dynamicButtons("Update", myTr, updateData, data, "btn btn-secondary") : dynamicButtons("Edit", myTr, editData, data, "btn btn-warning");
            dynamicButtons("Delete", myTr, deleteData, data, "btn btn-danger")
        }
        document.querySelector(target).appendChild(myTr);
    }
    editData = (data) => {
        data.isEdit = true;
        console.log(data)
        let editData = localStorage.setItem("editDetails", JSON.stringify(data));
        displayTable();
    }
    updateData = () => {
        var data = readOnlyDataFromFOM();
        console.log(data);
        commonServerCommunication("PUT", data)
    }
    deleteData = (data) => {
        commonServerCommunication("DELETE", data)
    }
    function headingDisplay() {
        commonDataDisplayTable(details[0], "th", "thead");
    }

    function displayTable() {
        document.querySelector("tbody").innerHTML = "";
        details.forEach((data) => {
            commonDataDisplayTable(data, "td", "tbody", data);
        })
    }
    function readOnlyDataFromFOM() {
        let obj = {};
        obj.id = "";
        var StringObject = localStorage.getItem("ObjectDetails")
        let originalObject = JSON.parse(StringObject);
        let data = Object.assign(obj, originalObject);
        for (a in data) {
            data[a] = document.getElementById(a).value;
        }
        return data;
    }
</script>

</html>